# CMS 前端（Vue3 + Ant Design Vue）开发规范

更新时间：2025-12-03

## 目录与命名
- 项目为纯前端后管，根目录关键目录：`src/`, `mock/`, `env/`, `scripts/`, `docs/`
- 视图页面规则：`src/views/<PageName>/`，首字母大写（驼峰式）
  - 主入口文件：`Index.vue` 或 `Main.vue`
  - 私有组件目录：`components/`（不使用公共组件目录）
  - 详情页均为“单独页面”，按上述规则独立创建与维护

## 路由
- 运行时自动路由：`@utils/auto-routes` 扫描 `src/views/**/{Index,Main}.vue` 生成扁平路由
- 扁平化：不使用子路由；布局通过包装组件实现
- 登录路由：`/login`，无 `localStorage.token` 时跳转登录；有 token 访问 `/login` 重定向首页

## 布局与样式
- 统一布局：`src/layouts/Admin/Index.vue`
  - 侧栏：`Antd Sider`，`v-model:collapsed` 折叠，`breakpoint="lg"`，`collapsedWidth=64`
  - 头部：登录状态、头像、用户名、下拉“个人中心/退出登录”
  - 内容：白底、圆角与间距（`background:#fff; padding:24px; margin:20px; border-radius:8px`）
- 菜单：严格使用 Antd 默认样式；分组（如“素材”、“系统配置”）用 `a-sub-menu`

## 导航数据（Mock）
- 文件：`mock/nav.json`，支持分组与子菜单结构（`children`）
- 页面级关闭布局：`layout:false` 将页面加入 Pinia `noLayoutPages`，渲染时不包裹布局

## 环境与别名
- 环境目录：`env/`，通过 `vite.config.js` 的 `envDir: 'env'` 生效
- 变量：`VITE_APP_ENV`, `VITE_API_BASE_URL`, `VITE_LAYOUT_ENABLED`, 以及 `VITE_HTTP_*` 参数
- 别名（示例）：`@`→`src`，`@apis`, `@views`, `@layouts`, `@stores`, `@utils`, `@config`, `@mock`

## 脚本与命令
- 集中入口：`npm run cmd <name>`，委托给 `scripts/commands.mjs`
- 常用：
  - `serve:dev`/`serve:test`/`serve` 启动不同环境
  - `build`/`build:dev`/`build:test`/`build:pre` 构建
  - `routes:generate` 扫描 `views` 生成 `src/router/routes.gen.json`
  - `lint`/`lint:fix` 代码检查

## HTTP 封装（黑盒）
- 文件：`src/utils/http.js`
- 能力：`fetch` 优先、`XHR` 降级；超时（默认 10s）、重试、轮询；`upload` 支持 `FormData/Blob/File` 与 `params` 拼接
- 纯请求工具，不维护路径；API 层拼接完整 URL
- 公共配置：通过 `@apis/main` 初始化（读取 `import.meta.env`），单次请求可覆盖

## API 规范
- 主入口：`src/apis/main.js`，仅暴露公共方法与公共参数初始化，不引用具体接口文件
- 各模块接口文件引入 `@apis/main` 提供的 `get/post/...`，并读取 `@config/env` 拼接完整 URL
- 示例：`src/apis/system/menu.js` 使用 `apiBaseUrl` 对接 `mock/system/menu/*.json`

## 文案与语言
- 全局语言：`App.vue` 使用 `a-config-provider` 设置 `zhCN`
- 所有确认与取消文案统一中文：
  - 模态框：`okText: 保存/确认删除`，`cancelText: 取消`
  - 气泡确认：`okText: 确认`，`cancelText: 取消`

## Mock 规范
- 统一在 `mock/` 维护；`vite.config.js` 内置中间件映射到 `/mock/*`
- 列表接口返回 `{ items, total }`；操作接口返回 `{ success: true }`

## 登录与鉴权
- 本地存储：`localStorage.token`
- 路由守卫：验证 token 决定跳转登录或首页；Pinia `auth` 同步登录状态与用户信息（含头像）

## 页面模板示例
- 系统配置聚合页面：`src/views/SystemConfig/Index.vue`
- 菜单管理页面：`src/views/SystemMenu/Index.vue`
  - 采用 `setup` + `provide/inject` 管理状态与方法
  - 组件划分：`Filter`（筛选）、`List`（列表+分页+工具栏）、`EditModal`（弹窗）、`BatchDeleteConfirm`（二次确认）
  - 功能：新增/编辑/删除、批量添加/编辑/删除、同级拖拽排序、树形展开、行操作使用链接样式，删除二次确认
  - 初始化静态数据：`initData.js` 位于页面文件夹内

## 页面目录结构规范（约定示例）
```
src/views/
  Dashboard/
    Index.vue
    components/
      ...
  SystemConfig/
    Index.vue
  SystemMenu/
    Index.vue
    components/
      Filter.vue
      List.vue
      EditModal.vue
      BatchDeleteConfirm.vue
    initData.js
  MaterialImage/
    Index.vue
    components/
      ...
```

## 代码规范
- ESLint：`.eslintrc.cjs`（`eslint:recommended`, `plugin:vue/vue3-recommended`），关闭 `vue/multi-word-component-names`
- 忽略：`.eslintignore` 包含 `dist/`, `node_modules/`, `env/`, `mock/*.json`, `src/router/routes.gen.json`

## 约定
- 所有“详情页”按页面规则单独创建维护（单独路由、单独目录、私有组件）
- 严格使用 Ant Design Vue 的默认样式与交互，避免自行覆盖除非规范明确要求
- 任何公共能力（HTTP、配置、脚本、路由扫描）集中入口维护，避免分散定义